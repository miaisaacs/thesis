---
title: "Data Analysis"
author: "Mia Isaacs"
date: "2025-03-27"
output: github_document
---

### load packages

```{r}
library(tidyverse)
library(Biostrings)
library(Pviz)
library(Gviz)
library(stringr)
library(GenomicRanges)
library(preprocessCore) 
library(mclust) 
```

### view dataset

```{r}
dengueIgG_all = read_csv("data/Dengue_data_analysis_IgG.csv") |> 
  janitor::clean_names()

view(dengueIgG_all)
```

### remove unncessary variables
```{r}
dengueIgG_clean <- dengueIgG_all |> 
  select(-accession, -p_val_acute_conv, -p_adjust_acute_conv, -p_val_acute_nc, -p_adjust_acute_nc, -p_val_conv_nc,
         -p_adjust_conv_nc, -x10, -acute, -conv, -nc, -row_total_x, -control, -d1_acute, -d1_conv, -d2_acute,
         -d2_conv, -d3_acute, -d3_conv, -d3d4_acute, -d3d4_conv, -d4_acute, -d4_conv,z_conv, -zd_conv, -zdyfv_conv,
         -zyfv_conv, -row_total_y, -z_conv)

head(dengueIgG_clean)
```

### check for missing values (all good!)
```{r}
sum(is.na(dengueIgG_clean))
```

### convert to long format for easier manipulation
```{r}
dengueIgG_long <- dengueIgG_clean |> 
  pivot_longer(cols = matches("uwa_"),
               names_to = "sample",
               values_to = "fluorescence")

head(dengueIgG_long)
```

### add log transformed fluorescence values for future analysis
```{r}
dengueIgG_transform <- dengueIgG_long |> 
  mutate(fluorescence_log = log(fluorescence))

head(dengueIgG_transform)
```

## prepare data for quantile normalization

### extract serotype from sample name
```{r}
dengueIgG_serotype <- dengueIgG_transform |> 
  mutate(serotype = str_extract(sample, "_(d[1-4]d[1-4]|d[1-4]|z|zd|zdyfv|zyfv|nc)_") |>  
           str_replace_all("_", "")) |> 
  arrange(sample)
```

### visualize distributions of fluorescence values across serotypes
```{r}
ggplot(dengueIgG_serotype, aes(x = serotype, y = fluorescence)) +
  geom_boxplot() +
  ggtitle("Original Fluorescence Distributions by Serotype")
```

fluorescence values appear to be similarly distributed across all serotypes, except for the negative control. despite the similarities, i will complete quantile normalization to be sure that my data is properly aligned.

### normalize across all serotypes
```{r}
# extract fluorescence values as a matrix
fluorescence_matrix <- as.matrix(dengueIgG_serotype |> select(fluorescence))

# perform quantile normalization across ALL samples together
fluorescence_norm <- normalize.quantiles(fluorescence_matrix)

# add normalized values back to the full dataset
dengueIgG_serotype$fluorescence_norm <- as.vector(fluorescence_norm)

head(dengueIgG_serotype)
```

### summarize fluorescence values to normalized values to observe any differences
```{r}
original_summary <- dengueIgG_serotype |> 
  summarize(
    min = min(fluorescence, na.rm = TRUE),
    q1 = quantile(fluorescence, 0.25, na.rm = TRUE),
    median = median(fluorescence, na.rm = TRUE),
    mean = mean(fluorescence, na.rm = TRUE),
    q3 = quantile(fluorescence, 0.75, na.rm = TRUE),
    max = max(fluorescence, na.rm = TRUE),
    sd = sd(fluorescence, na.rm = TRUE)
  )

normalized_summary <- dengueIgG_serotype |> 
  summarize(
    min = min(fluorescence_norm, na.rm = TRUE),
    q1 = quantile(fluorescence_norm, 0.25, na.rm = TRUE),
    median = median(fluorescence_norm, na.rm = TRUE),
    mean = mean(fluorescence_norm, na.rm = TRUE),
    q3 = quantile(fluorescence_norm, 0.75, na.rm = TRUE),
    max = max(fluorescence_norm, na.rm = TRUE),
    sd = sd(fluorescence_norm, na.rm = TRUE)
  )

print(original_summary)
print(normalized_summary)
```

### visualize fluorescence vs. normalized values in density plots
```{r}
ggplot(sample_n(dengueIgG_serotype, 5000), aes(x = fluorescence)) +
  geom_density() +
  ggtitle("Fluorescence Density (Original)")

ggplot(sample_n(dengueIgG_serotype, 5000), aes(x = fluorescence_norm)) +
  geom_density() +
  ggtitle("Fluorescence Density (Normalized)")
```

according to the summary statistics and density plots, the normalized fluorescence values are identical to the original fluorescence values. therefore, quantile normalization was not necessary for this dataset but will be maintained until completion of the analysis. (may not be included in report)
